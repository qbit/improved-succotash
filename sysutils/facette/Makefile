BROKEN =	fetches from internet during build

COMMENT =	time series data visualization and graphing software

GH_ACCOUNT =	facette
GH_PROJECT =	facette
GH_TAGNAME =	0.5.1
REVISION =	1

CATEGORIES =	sysutils

HOMEPAGE =	https://facette.io

# selfhosted node_modules deps generated via 'gmake node_modules' in
# $WRKSRC/ui .
# selfhosted asset deps are generated by: 'gmake build-docs' for man pages and
# 'go-bindata -pkg web -prefix ../dist/assets -tags builtin_assets -o bindata.go ../dist/assets/...'
# in WRKSRC/web .
# For the above to work, pandoc and go-bindata need to be installed.
DISTFILES =	${GH_DISTFILE} \
		${GH_PROJECT}-${GH_TAGNAME}-node_modules${EXTRACT_SUFX}:0 \
		${GH_PROJECT}-${GH_TAGNAME}-assets${EXTRACT_SUFX}:0
MASTER_SITES0 =	https://deftly.net/dist/

# BSD
PERMIT_PACKAGE =	Yes

BUILD_DEPENDS =	lang/go \
		lang/node
LIB_DEPENDS =	net/rrdtool
WANTLIB +=	c pthread rrd

PORTHOME =		${WRKDIR}
MAKE_ENV =		CGO_LDFLAGS="-Wl,-rpath -Wl,${X11BASE}/lib"
USE_GMAKE =		Yes
SUBST_VARS +=	VARBASE

post-patch:
	ln -s ${WRKDIR}/node_modules ${WRKSRC}/ui/node_modules
	ln -s ${WRKDIR}/dist ${WRKSRC}/dist
	cp ${WRKDIR}/web/bindata.go ${WRKSRC}/web/

post-install:
	${INSTALL_DATA_DIR} ${PREFIX}/share/examples/facette/
	${SUBST_CMD} -c ${WRKSRC}/docs/examples/facette.yaml \
		${PREFIX}/share/examples/facette/facette.yaml

.include <bsd.port.mk>
